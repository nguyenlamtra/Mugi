/*!
 * jQuery Magnify Plugin v2.1.0 by T. H. Doan (http://thdoan.github.io/magnify/)
 * Based on http://thecodeplayer.com/walkthrough/magnifying-glass-for-images-using-jquery-and-css3
 *
 * jQuery Magnify by T. H. Doan is licensed under the MIT License.
 * Read a copy of the license in the LICENSE file or at http://choosealicense.com/licenses/mit
 */
(function(n){n.fn.magnify=function(t){t=n.extend({src:"",speed:100,timeout:-1,finalWidth:null,finalHeight:null,magnifiedWidth:null,magnifiedHeight:null,limitBounds:!1,afterLoad:function(){}},t);var i=this,u=n("html"),e=function(i){var f=n(i),y=f.closest("a"),e={},it,p,s;for(it in t)e[it]=f.attr("data-magnify-"+it.toLowerCase());if(p=e.src||t.src||y.attr("href")||"",p){var h,o,v,a,c,l,w,b,d=0,g=0,nt,k,rt=function(){var n=h.offset();return k={top:f.offset().top-n.top+parseInt(f.css("border-top-width"))+parseInt(f.css("padding-top")),left:f.offset().left-n.left+parseInt(f.css("border-left-width"))+parseInt(f.css("padding-left"))},n.top+=k.top,n.left+=k.left,n},tt=function(){o.is(":visible")&&o.fadeOut(t.speed,function(){u.removeClass("magnifying").trigger("magnifyend")})};isNaN(+e.speed)||(t.speed=+e.speed);isNaN(+e.timeout)||(t.timeout=+e.timeout);isNaN(+e.finalWidth)||(t.finalWidth=+e.finalWidth);isNaN(+e.finalHeight)||(t.finalHeight=+e.finalHeight);isNaN(+e.magnifiedWidth)||(t.magnifiedWidth=+e.magnifiedWidth);isNaN(+e.magnifiedHeight)||(t.magnifiedHeight=+e.magnifiedHeight);e.limitBounds==="true"&&(t.limitBounds=!0);typeof window[e.afterLoad]=="function"&&(t.afterLoad=window[e.afterLoad]);f.data("originalStyle",f.attr("style"));s=new Image;n(s).on({load:function(){var i,it,ut,ft;f.css("display","block");f.parent(".magnify").length||f.wrap('<div class="magnify"><\/div>');h=f.parent(".magnify");f.prev(".magnify-lens").length?h.children(".magnify-lens").css("background-image","url('"+p+"')"):f.before('<div class="magnify-lens loading" style="background:url(\''+p+"') 0 0 no-repeat\"><\/div>");o=h.children(".magnify-lens");o.removeClass("loading");v=t.finalWidth||f.width();a=t.finalHeight||f.height();c=t.magnifiedWidth||s.width;l=t.magnifiedHeight||s.height;w=o.width();b=o.height();nt=rt();t.limitBounds&&(d=w/2/(c/v),g=b/2/(l/a));(c!==s.width||l!==s.height)&&o.css("background-size",c+"px "+l+"px");f.data("zoomSize",{width:c,height:l});s=null;t.afterLoad();h.off().on({"mousemove touchmove":function(n){var s,f,e,h,y;if(n.preventDefault(),!a){r();return}i=(n.pageX||n.originalEvent.touches[0].pageX)-nt.left;it=(n.pageY||n.originalEvent.touches[0].pageY)-nt.top;o.is(":animated")||(i>d&&i<v-d&&it>g&&it<a-g?o.is(":hidden")&&(u.addClass("magnifying").trigger("magnifystart"),o.fadeIn(t.speed)):tt());o.is(":visible")&&(s="",c&&l&&(f=-Math.round(i/v*c-w/2),e=-Math.round(it/a*l-b/2),t.limitBounds&&(h=-Math.round((v-d)/v*c-w/2),y=-Math.round((a-g)/a*l-b/2),f>0?f=0:f<h&&(f=h),e>0?e=0:e<y&&(e=y)),s=f+"px "+e+"px"),o.css({top:Math.round(it-b/2)+k.top+"px",left:Math.round(i-w/2)+k.left+"px","background-position":s}))},mouseenter:function(){nt=rt()},mouseleave:tt});if(t.timeout>=0)h.on("touchend",function(){setTimeout(tt,t.timeout)});n("body").not(h).on("touchstart",tt);ut=f.attr("usemap");ut&&(ft=n("map[name="+ut.slice(1)+"]"),f.after(ft),h.click(function(t){if(t.clientX||t.clientY){o.hide();var r=document.elementFromPoint(t.clientX||t.originalEvent.touches[0].clientX,t.clientY||t.originalEvent.touches[0].clientY);r.nodeName==="AREA"?r.click():n("area",ft).each(function(){var t=n(this).attr("coords").split(",");if(i>=t[0]&&i<=t[2]&&it>=t[1]&&it<=t[3])return this.click(),!1})}}));y.length&&(y.css("display","inline-block"),!y.attr("href")||e.src||t.src||y.click(function(n){n.preventDefault()}))},error:function(){s=null}});s.src=p}},f=0,r=function(){clearTimeout(f);f=setTimeout(function(){i.destroy();i.magnify(t)},100)};return this.destroy=function(){return this.each(function(){var t=n(this),i=t.prev("div.magnify-lens"),r=t.data("originalStyle");t.parent("div.magnify").length&&i.length&&(r?t.attr("style",r):t.removeAttr("style"),t.unwrap(),i.remove())}),n(window).off("resize",r),i},n(window).resize(r),this.each(function(){e(this)})}})(jQuery);